(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["SysUsers"],{"37df":function(e,s,i){"use strict";i.r(s);var t=function(){var e=this,s=e._self._c;return s("v-container",{attrs:{fluid:""}},[s("v-toolbar",[s("v-toolbar-title",[e._v("사용자 관리")]),s("v-divider",{staticClass:"mx-4",attrs:{inset:"",vertical:""}}),s("v-spacer"),s("v-btn",{staticClass:"mr-2",attrs:{color:"primary",dark:""},on:{click:function(s){return e.openDialog()}}},[e._v("사용자 추가")])],1),s("v-card",[s("v-card-title",[s("v-text-field",{attrs:{"append-icon":"mdi-magnify",label:"Search","single-line":"","hide-details":"",sm:"2"},model:{value:e.search,callback:function(s){e.search=s},expression:"search"}})],1),s("v-data-table",{attrs:{headers:e.headers,items:e.users,search:e.search,loading:e.loading},on:{"dblclick:row":e.showRowInfo}})],1),s("ez-dialog",{ref:"dialog",attrs:{label:"사용자 추가/수정",width:"400",color:"primary",persistent:""},on:{onClose:e.onClose}},[s("sys-users-form",{attrs:{user:e.user,companys:e.compnayLists,isNew:e.isNew,cbCheckId:e.cbCheckId,onClose:e.onClose},on:{onSave:e.save,onDelete:e.userdel}})],1)],1)},o=[],a=(i("14d9"),i("2f62")),n=i("a2e4"),r=function(){var e=this,s=e._self._c;return s("v-form",{ref:"form",attrs:{"lazy-validation":""},on:{submit:function(s){return s.preventDefault(),e.save.apply(null,arguments)}},model:{value:e.valid,callback:function(s){e.valid=s},expression:"valid"}},[s("v-select",{attrs:{"prepend-icon":"mdi-office-building-outline",items:e.companys,hint:`${e.form.i_com.n_com||""}, ${e.form.i_com.i_com||""}`,"item-text":"n_com","item-value":"i_com",label:"사업장","persistent-hint":"","return-object":"",readonly:!e.isNew,rules:e.user_icom},model:{value:e.form.i_com,callback:function(s){e.$set(e.form,"i_com",s)},expression:"form.i_com"}}),s("input-duplicate-check",{ref:"id",attrs:{label:"아이디","prepend-icon":"mdi-account",counter:"15",origin:e.originKey,rules:e.rules.id(),readonly:!e.isNew,cbCheck:e.cbCheckId},model:{value:e.form.i_id,callback:function(s){e.$set(e.form,"i_id",s)},expression:"form.i_id"}}),s("v-text-field",{attrs:{label:"이름","prepend-icon":"mdi-card-account-details-outline",rules:e.rules.name()},model:{value:e.form.n_name,callback:function(s){e.$set(e.form,"n_name",s)},expression:"form.n_name"}}),e.isNew?s("input-password",{attrs:{label:"비밀번호","prepend-icon":"mdi-lock",rules:e.rules.password()},model:{value:e.form.i_password,callback:function(s){e.$set(e.form,"i_password",s)},expression:"form.i_password"}}):e._e(),e.isNew?e._e():s("input-password",{attrs:{label:"비밀번호","prepend-icon":"mdi-lock",rules:e.rules.password2()},model:{value:e.form.i_password,callback:function(s){e.$set(e.form,"i_password",s)},expression:"form.i_password"}}),s("v-text-field",{attrs:{label:"비고","prepend-icon":"mdi-note"},model:{value:e.form.t_memo,callback:function(s){e.$set(e.form,"t_memo",s)},expression:"form.t_memo"}}),s("v-btn",{attrs:{type:"submit",block:"",color:"primary",loading:e.isLoading}},[e._v(e._s(e.isNew?"추 가":"수 정"))]),e.isNew?e._e():s("v-btn",{attrs:{block:"",loading:e.isLoading},on:{click:e.delUser}},[e._v("삭 제")])],1)},l=[],c=i("64f2"),d=i("248f"),u=i.n(d),h=i("50d8"),m=function(){var e=this,s=e._self._c;return s("v-text-field",e._b({ref:"field",attrs:{value:e.value,maxlength:e.$attrs.counter,"error-messages":e.errMsg,"success-messages":e.successMsg},on:{input:e.onInput},scopedSlots:e._u([e.isCheck?null:{key:"append",fn:function(){return[s("v-tooltip",{attrs:{top:""},scopedSlots:e._u([{key:"activator",fn:function({on:i,attrs:t}){return[s("v-btn",e._g(e._b({attrs:{icon:"",small:"",tabindex:"-1",loading:e.loading},on:{click:e.check}},"v-btn",t,!1),i),[s("v-icon",[e._v("mdi-check")])],1)]}}],null,!1,1344435932)},[e._v(" "+e._s(e.$attrs.label)+" 중복검사 ")])]},proxy:!0}],null,!0)},"v-text-field",e.$attrs,!1))},p=[],f={name:"InputDuplicateCheck2",model:{prop:"value",event:"input"},props:{value:String,cbCheck:{type:Function,default:null},origin:{type:String,default:""}},watch:{origin(){this.isCheck=!!this.origin||!this.cbCheck}},data(){return{isCheck:!!this.origin||!this.cbCheck,loading:!1,errMsg:"",successMsg:""}},computed:{isSend(){return!!this.cbCheck&&0===this.$refs.field.errorBucket.length}},mounted(){},methods:{onInput(e){this.isCheck=this.origin?this.origin===e:!this.cbCheck,this.errMsg="",this.successMsg="",this.$emit("input",e)},async check(){if(!this.isSend)return;this.loading=!0,this.errMsg="",this.successMsg="";const e=await this.cbCheck(this.value);this.value?0==e.cnt?(this.successMsg=`사용 가능한 ${this.$attrs.label} 입니다.`,this.isCheck=!0):(this.errMsg=`중복된 ${this.$attrs.label} 입니다.`,this.isCheck=!1):this.successMsg="",this.loading=!1},validate(){return this.isCheck||(this.errMsg=this.$attrs.label+" 중복검사를 해주세요.",this.$refs.field.focus()),this.isCheck}}},_=f,v=i("2877"),b=Object(v["a"])(_,m,p,!1,null,null,null),g=b.exports,k=i("445e"),w={components:{InputDuplicateCheck:h["a"],InputDuplicateCheck2:g,InputPassword:k["a"]},name:"SysUsersForm",props:{user:{type:Object,default:null},companys:null,cbCheckId:{type:Function,default:null},isLoading:Boolean,isNew:Boolean},data(){return{valid:!0,form:{i_com:"",i_id:"",i_password:"",n_name:"",t_memo:""},user_icom:[e=>!!e||"사업장 필수 입력사항입니다.",e=>!(e&&e.length>=30)||"이름은 30자 이상 입력할 수 없습니다.",e=>!/[~!@#$%^&*()_+|<>?:{}]/.test(e)||"이름에는 특수문자를 사용할 수 없습니다."]}},mounted(){},watch:{user(){this.init()}},computed:{rules:()=>u.a,originKey(){return this.user?this.user.i_id:""}},created(){this.init()},destroyed(){this.form=null},methods:{init(){this.user?this.form=Object(c["deepCopy"])(this.user):this.form={i_com:"",i_id:"",i_password:"",n_name:"",t_memo:""},this.form.i_password="",this.$refs.form&&this.$refs.form.resetValidation()},async save(){if(this.$refs.form.validate(),await this.$nextTick(),!this.valid)return;if(!this.$refs.id.validate())return;const e=new FormData,s=Object.keys(this.form);for(const i of s)"i_com"==i?this.isNew?(e.append(i,this.form.i_com.i_com),e.append("n_com",this.form.i_com.n_com)):e.append(i,this.form.i_com):"n_com"!=i||this.isNew?e.append(i,this.form[i]):e.append(i,this.form.n_com);this.$emit("onSave",e),this.init()},async delUser(){const e=new FormData,s=Object.keys(this.form);for(const i of s)"i_com"==i?this.isNew?(e.append(i,this.form.i_com.i_com),e.append("n_com",this.form.i_com.n_com)):e.append(i,this.form.i_com):"n_com"!=i||this.isNew?e.append(i,this.form[i]):e.append(i,this.form.n_com);this.$emit("onDelete",e)}}},y=w,$=Object(v["a"])(y,r,l,!1,null,null,null),C=$.exports,x={components:{EzDialog:n["a"],SysUsersForm:C},name:"SysUsers",data(){return{search:"",loading:!1,compnayLists:[],headers:[{text:"사업장명",value:"n_com"},{text:"ID",value:"i_id"},{text:"성명",value:"n_name"},{text:"메모",value:"t_memo"}],users:[],company:-1,curUsers:[],user:null,isNew:!0,isEdit:!1}},computed:{companyUsers(){},companyName(){}},watch:{company(){}},mounted(){this.fetchData()},methods:{...Object(a["b"])("company",["createUser","updateUser","deleteUser","duplicateCheckId"]),onClose(){this.isEdit||this.users&&(this.user?this.user=null:this.user=this.users[0])},async fetchData(){this.compnayLists=await this.$axios.get("/api/company/companylist"),this.users=await this.$axios.get("/api/company/companyusers")},openDialog(){this.isNew=!0,this.user=null,this.isEdit=!1,this.$refs.dialog.open()},showRowInfo(e,{item:s}){this.isNew=!1,this.isEdit=!1,this.user=s,this.$refs.dialog.open()},handleClick({item:e}){console.log("item",this.item)},async cbCheckId(e){const s={field:"i_id",value:e};return await this.duplicateCheckId(s)},async save(e){if(this.isLoading=!0,this.isNew){const s=await this.createUser(e);s&&(this.users.push(s),this.$toast.info(s.i_id+" 추가 하였습니다."))}else{const s=await this.updateUser(e);if(s)if(1==s){const e=this.users.indexOf(this.user);this.users.splice(e,1),this.$toast.info(this.user.i_id+" 삭제 하였습니다.")}else{const e=this.users.indexOf(this.user);this.users.splice(e,1,s),this.$toast.info(this.user.i_id+" 수정 하였습니다.")}}this.isEdit=!0,this.isLoading=!1,this.$refs.dialog.close()},async userdel(e){const s=await this.$ezNotify.confirm(`<b>${this.user.i_id}</b> 삭제 하시겠습니까?`,"사용자 삭제",{icon:"mdi-delete",iconColor:"red"});if(!s)return void this.$refs.dialog.close();this.isEdit=!0;const i=this.users.indexOf(this.user);this.users.splice(i,1),this.$toast.info(this.user.i_id+" 삭제 하였습니다.");await this.deleteUser(e);this.$refs.dialog.close()}}},N=x,I=Object(v["a"])(N,t,o,!1,null,null,null);s["default"]=I.exports},a2e4:function(e,s,i){"use strict";var t=function(){var e=this,s=e._self._c;return s("v-dialog",e._b({model:{value:e.dialog,callback:function(s){e.dialog=s},expression:"dialog"}},"v-dialog",e.$attrs,!1),[s("v-card",[s("v-toolbar",[s("v-toolbar-title",[e._v(e._s(e.label))]),s("v-spacer"),s("v-btn",{attrs:{icon:""},on:{click:e.close}},[s("v-icon",[e._v("mdi-close")])],1)],1),s("v-card-text",[e._t("default")],2)],1)],1)},o=[],a={name:"ezDialog",props:{label:{type:String,required:!0}},data(){return{dialog:!1}},methods:{close(){this.dialog=!1,this.$emit("onClose")},open(){this.$emit("onOpen"),this.dialog=!0}}},n=a,r=i("2877"),l=Object(r["a"])(n,t,o,!1,null,null,null);s["a"]=l.exports}}]);
//# sourceMappingURL=SysUsers.62e35c79.js.map