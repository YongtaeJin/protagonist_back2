(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["AdmConfig"],{9415:function(t,e,i){"use strict";i.r(e);var a=function(){var t=this,e=t._self._c;return e("v-container",{attrs:{fluid:""}},[e("v-toolbar",[e("v-toolbar-title",[t._v("설정관리")]),e("v-spacer"),e("tooltip-btn",{attrs:{fab:"",small:"",label:"설정추가",color:"primary"},on:{click:t.addConfig}},[e("v-icon",[t._v("mdi-plus")])],1),e("tooltip-btn",{attrs:{fab:"",small:"",label:"서버재시작",color:"error",childClass:"ml-2",loading:t.restart},on:{click:t.restartServer}},[e("v-icon",[t._v("mdi-power")])],1)],1),e("v-row",[e("v-col",[e("v-tabs",{attrs:{"background-color":"primary",dark:""},model:{value:t.group,callback:function(e){t.group=e},expression:"group"}},t._l(t.groupItems,(function(i){return e("v-tab",{key:i},[t._v(" "+t._s(i)+" ")])})),1)],1)],1),e("draggable",{staticClass:"config-list-group",attrs:{tag:"ul",list:t.curItems,handle:".handle"},on:{end:t.sortEnd}},t._l(t.curItems,(function(i){return e("config-item",{key:i.cf_key,staticClass:"list-group-item",attrs:{item:i},on:{update:t.updateConfig,remove:t.removeConfig}})})),1),e("ez-dialog",{ref:"dialog",attrs:{label:"설정 추가","max-width":"500",dark:"",color:"primary",persistent:""}},[e("config-form",{attrs:{keyCheck:t.keyCheck,item:t.item,groupItems:t.groupItems},on:{save:t.save}})],1)],1)},o=[],s=(i("14d9"),i("2f62")),r=function(){var t=this,e=t._self._c;return e("v-dialog",t._b({model:{value:t.dialog,callback:function(e){t.dialog=e},expression:"dialog"}},"v-dialog",t.$attrs,!1),[e("v-card",[e("v-toolbar",[e("v-toolbar-title",[t._v(t._s(t.label))]),e("v-spacer"),e("v-btn",{attrs:{icon:""},on:{click:t.close}},[e("v-icon",[t._v("mdi-close")])],1)],1),e("v-card-text",[t._t("default")],2)],1)],1)},l=[],n={name:"ezDialog",props:{label:{type:String,required:!0}},data(){return{dialog:!1}},methods:{close(){this.dialog=!1},open(){this.dialog=!0}}},c=n,f=i("2877"),u=Object(f["a"])(c,r,l,!1,null,null,null),m=u.exports,p=function(){var t=this,e=t._self._c;return e("v-tooltip",{attrs:{top:""},scopedSlots:t._u([{key:"activator",fn:function({on:i,attrs:a}){return[e("v-btn",t._g(t._b({class:t.childClass,on:{click:function(e){return t.$emit("click")}}},"v-btn",{...a,...t.$attrs},!1),i),[t._t("default")],2)]}}],null,!0)},[e("span",[t._v(t._s(t.label))])])},d=[],v={name:"TooltipBtn",props:{label:{type:String,required:!0},childClass:[String,Object]}},_=v,h=Object(f["a"])(_,p,d,!1,null,null,null),y=h.exports,g=function(){var t=this,e=t._self._c;return e("v-form",{ref:"form",attrs:{"lazy-validation":""},on:{submit:function(e){return e.preventDefault(),t.save.apply(null,arguments)}},model:{value:t.valid,callback:function(e){t.valid=e},expression:"valid"}},[e("v-combobox",{attrs:{items:t.groupItems,label:"그룹",rules:[t.rules.require({label:"그룹"})]},model:{value:t.form.cf_group,callback:function(e){t.$set(t.form,"cf_group",e)},expression:"form.cf_group"}}),e("div",{staticClass:"d-flex"},[e("v-tooltip",{attrs:{top:""},scopedSlots:t._u([{key:"activator",fn:function({on:i,attrs:a}){return[e("span",t._g(t._b({staticClass:"mr-2"},"span",a,!1),i),[e("v-checkbox",{attrs:{"true-value":1,"false-value":0},model:{value:t.form.cf_client,callback:function(e){t.$set(t.form,"cf_client",e)},expression:"form.cf_client"}})],1)]}}])},[e("span",[t._v("클라이언트")])]),e("input-duplicate-check",{ref:"cfKey",attrs:{label:"키",cbCheck:t.keyCheck,origin:t.originKey,readonly:!!t.item,rules:[t.rules.require({label:"키"}),t.rules.alphaNum()]},model:{value:t.form.cf_key,callback:function(e){t.$set(t.form,"cf_key",e)},expression:"form.cf_key"}})],1),e("v-text-field",{attrs:{label:"이름",rules:t.rules.name()},model:{value:t.form.cf_name,callback:function(e){t.$set(t.form,"cf_name",e)},expression:"form.cf_name"}}),e("v-select",{attrs:{label:"값 타입",items:t.typeItems},model:{value:t.form.cf_type,callback:function(e){t.$set(t.form,"cf_type",e)},expression:"form.cf_type"}}),e("type-value",{attrs:{fieldType:t.form.cf_type},model:{value:t.form.cf_val,callback:function(e){t.$set(t.form,"cf_val",e)},expression:"form.cf_val"}}),e("v-slider",{attrs:{label:`접근레벨 (${t.form.cf_level})`,min:t.LV.ADMIN,max:t.LV.SUPER,"thumb-color":"primary","thumb-label":""},model:{value:t.form.cf_level,callback:function(e){t.$set(t.form,"cf_level",e)},expression:"form.cf_level"}}),e("v-textarea",{attrs:{label:"설명"},model:{value:t.form.cf_comment,callback:function(e){t.$set(t.form,"cf_comment",e)},expression:"form.cf_comment"}}),e("v-btn",{attrs:{type:"submit",block:""}},[t._v("저장")])],1)},b=[],k=i("248f"),$=i.n(k),x=i("50d8"),C=i("bb5e"),S=function(){var t=this,e=t._self._c;return"String"==t.fieldType?e("div",[e("v-text-field",{attrs:{label:"Value",value:t.value,readonly:t.readonly,"hide-details":t.readonly},on:{input:t.onInput}})],1):"Number"==t.fieldType?e("div",[e("v-text-field",{attrs:{label:"Value",type:"number",value:t.value,readonly:t.readonly,"hide-details":t.readonly},on:{input:t.onInput}})],1):"CheckBox"==t.fieldType?e("div",[e("v-checkbox",{attrs:{label:"Check value","input-value":t.value,readonly:t.readonly,"hide-details":t.readonly,"true-value":"1","false-value":"0"},on:{change:t.onInput}})],1):"Json"==t.fieldType?e("div",[t.readonly?[e("v-btn",{attrs:{color:"primary"},on:{click:function(e){return t.$refs.dialog.open()}}},[t._v("JSON 보기")]),e("ez-dialog",{ref:"dialog",attrs:{label:"JSON 값 보기","max-width":"500"}},[e("pre",{staticClass:"mt-4"},[t._v(t._s(t.stringify()))])])]:e("v-textarea",{attrs:{label:"Value",value:t.value},on:{input:t.onInput}})],2):"Secret"==t.fieldType?e("div",[e("input-password",{attrs:{label:"Sercet Value",value:t.value,readonly:t.readonly,"hide-details":t.readonly},on:{input:t.onInput}})],1):e("div",[e("div",[t._v("선택한 타입 입력필드가 없습니다.")])])},I=[],w=i("445e"),O=i("ac4f"),T=i.n(O),N={components:{InputPassword:w["a"],EzDialog:m},name:"TypeValue",model:{prop:"value",event:"input"},props:{value:{type:String},fieldType:{type:String,default:"String"},readonly:{type:Boolean,default:!1}},methods:{onInput(t){this.$emit("input",t)},stringify(){const t=JSON.parse(this.value),e=T()(t,{space:"  "});return e}}},j=N,J=Object(f["a"])(j,S,I,!1,null,null,null),V=J.exports,D=i("64f2"),z={components:{InputDuplicateCheck:x["a"],TypeValue:V},name:"ConfigForm",props:{keyCheck:{type:Function,default:null},groupItems:{type:Array,default:[]},item:{type:Object,default:null}},data(){return{valid:!0,form:{cf_key:"",cf_val:"",cf_name:"",cf_group:"",cf_level:"",cf_type:"String",cf_comment:"",cf_client:0},typeItems:["String","Number","CheckBox","Json","Secret"]}},computed:{rules:()=>$.a,LV:()=>C["LV"],originKey(){return this.item?this.item.cf_key:""}},watch:{item(){this.init()}},created(){this.init()},methods:{init(){if(this.item){if(this.form=Object(D["deepCopy"])(this.item),"Json"==this.form.cf_type){const t=JSON.parse(this.form.cf_val);this.form.cf_val=T()(t,{space:"  "})}}else this.form={cf_key:"",cf_val:"",cf_name:"",cf_group:"",cf_level:"",cf_type:"String",cf_comment:"",cf_client:0};this.$refs.form&&this.$refs.form.resetValidation()},async save(){if(this.$refs.form.validate(),await this.$nextTick(),this.valid&&this.$refs.cfKey.validate()){if(!this.item){let t=0;const e=Object(D["findParentVm"])(this,"AdmConfig");e.items.forEach(e=>{e.cf_group==this.form.cf_group&&t++}),this.form.cf_sort=t}try{if("Json"==this.form.cf_type){const t=JSON.parse(this.form.cf_val);this.form.cf_val=JSON.stringify(t)}this.$emit("save",this.form),this.init()}catch(t){this.$toast.error("JSON 형식이 올바르지 않습니다.")}}}}},E=z,q=Object(f["a"])(E,g,b,!1,null,null,null),A=q.exports,B=i("b76a"),L=i.n(B),K=function(){var t=this,e=t._self._c;return e("li",[e("v-icon",{staticClass:"handle"},[t._v("mdi-drag")]),e("table",[e("tr",[e("td",[e("b",[t._v(t._s(t.item.cf_name))])]),e("td",[e("pre",{staticClass:"comment",domProps:{innerHTML:t._s(t.item.cf_comment)}})]),e("td",[e("v-tooltip",{attrs:{top:""},scopedSlots:t._u([{key:"activator",fn:function({on:i,attrs:a}){return[e("v-avatar",t._g(t._b({attrs:{color:"primary",dark:"",size:"32"}},"v-avatar",a,!1),i),[e("span",{staticClass:"white--text"},[t._v(t._s(t.item.cf_level))])])]}}])},[e("span",[t._v("접근레벨")])])],1),e("td",[e("v-btn",{attrs:{icon:"",color:"primary"},on:{click:function(e){return t.$emit("update",t.item)}}},[e("v-icon",[t._v("mdi-pencil")])],1)],1)]),e("tr",[e("td",[e("b",[t._v(t._s(t.item.cf_key))])]),e("td",[e("type-value",{attrs:{fieldType:t.item.cf_type,readonly:!0},model:{value:t.item.cf_val,callback:function(e){t.$set(t.item,"cf_val",e)},expression:"item.cf_val"}})],1),e("td",[e("v-tooltip",{attrs:{top:""},scopedSlots:t._u([{key:"activator",fn:function({on:i,attrs:a}){return[e("div",t._g(t._b({staticClass:"client"},"div",a,!1),i),[e("v-checkbox",{attrs:{readonly:"","hide-details":"",dense:""},model:{value:t.item.cf_client,callback:function(e){t.$set(t.item,"cf_client",e)},expression:"item.cf_client"}})],1)]}}])},[e("span",[t._v("클라이언트 접근")])])],1),e("td",[e("v-btn",{attrs:{icon:"",color:"error"},on:{click:function(e){return t.$emit("remove",t.item)}}},[e("v-icon",[t._v("mdi-delete")])],1)],1)])])],1)},P=[],F={components:{TypeValue:V},name:"ConfigItem",props:{item:{type:Object,required:!0}}},M=F,H=Object(f["a"])(M,K,P,!1,null,null,null),R=H.exports,U={components:{TooltipBtn:y,EzDialog:m,ConfigForm:A,draggable:L.a,ConfigItem:R},name:"AdmConfig",data(){return{items:[],group:-1,curItems:[],item:null,restart:!1}},computed:{...Object(s["e"])({online:t=>t.socket.online}),groupItems(){const t=new Set;return this.items.forEach(e=>{t.add(e.cf_group)}),[...t]},groupName(){return this.groupItems[this.group]||""}},watch:{group(){this.setCurItems()},online(){this.online&&(this.$toast.info("서버가 재시작 되었습니다."),this.restart=!1)}},mounted(){this.fetchData()},methods:{...Object(s["b"])(["configDuplicate","configSave"]),addConfig(){this.item=null,this.$refs.dialog.open()},updateConfig(t){this.item=t,this.$refs.dialog.open()},async save(t){const e=await this.configSave(t);if(e.cf_client?this.$socket.emit("config:update",{key:e.cf_key,value:e.cf_val}):this.item&&this.item.cf_client&&this.$socket.emit("config:remove",e.cf_key),this.item){this.$toast.info(`[${t.cf_name}] 수정 하였습니다.`);const e=this.items.indexOf(this.item);this.items.splice(e,1,t)}else this.$toast.info(`[${t.cf_name}] 추가 하였습니다.`),this.items.push(t);this.setCurItems(),this.$refs.dialog.close()},async removeConfig(t){const e=await this.$ezNotify.confirm(`<b>[${t.cf_name}]</b> 삭제 하시겠습니까?`,"설정항목 삭제",{icon:"mdi-delete",iconColor:"red"});if(!e)return;const i=await this.$axios.delete("/api/config/"+t.cf_key);if(i){t.cf_client&&this.$socket.emit("config:remove",t.cf_key),this.$toast.info(`[${t.cf_name}] 삭제 하였습니다.`);const e=this.items.indexOf(t);this.items.splice(e,1),this.setCurItems()}},async keyCheck(t){const e={field:"cf_key",value:t};return await this.configDuplicate(e)},async fetchData(){this.items=await this.$axios.get("/api/config?all=true")},sortEnd(){let t=0;const e=[];this.curItems.forEach(i=>{i.cf_sort=t++,e.push({cf_key:i.cf_key,cf_sort:i.cf_sort})}),this.$axios.put("/api/config",e)},setCurItems(){this.curItems=this.items.filter(t=>t.cf_group==this.groupName).sort((t,e)=>t.cf_sort-e.cf_sort)},async restartServer(){const t=await this.$ezNotify.confirm("서버를 재시작 하시겠습니까?","서버 재시작");if(!t)return;this.restart=!0;const e=await this.$axios.get("/api/config/restart");e&&this.$toast.error("서버 재시작을 요청하였습니다."),setTimeout(()=>{this.restart&&(this.restart=!1,this.$toast.error("서버 재시작을 실패하였습니다.\n다시 시도해주세요."))},2e4)}}},G=U,Q=Object(f["a"])(G,a,o,!1,null,null,null);e["default"]=Q.exports}}]);
//# sourceMappingURL=AdmConfig.dba73239.js.map